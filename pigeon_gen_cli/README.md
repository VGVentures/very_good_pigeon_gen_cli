## pigeon_gen_cli

![coverage][coverage_badge]
[![style: very good analysis][very_good_analysis_badge]][very_good_analysis_link]
[![License: MIT][license_badge]][license_link]

Generated by the [Very Good CLI][very_good_cli_link] ðŸ¤–

# Getting started

`pigeon_gen_cli` is a command-line tool designed to enhance the workflow of Flutter plugin development using [Pigeon](https://pub.dev/packages/pigeon). Its primary goal is to automate the process of generating a **flattened pigeon file**.

### What is a Flattened Pigeon File?

A *flattened pigeon file* is a single Dart file that contains:
- The original Pigeon API definitions (annotated with `@HostApi`, `@FlutterApi`, `@ConfigurePigeon`, etc.)
- Every class, enum, and type referenced by the API is copied and included directly in the same fileâ€”even if those definitions originally came from other files or were brought in through export (barrel) files.

This means that the generated file is fully self-contained and does **not** rely on any external imports (except for `package:pigeon/pigeon.dart`). This is especially useful for Pigeon, which requires all referenced types to be present in the same file for code generation to work correctly.


## Limitations

- All types used in your original Pigeon file (including imports/exports) must be defined in your own Dart package. Types or references from external packages are not supported.

### Example

Suppose you have the following Pigeon file (`messages_api.dart`):

```dart
import 'package:my_plugin_platform_interface/src/models/models.dart';
import 'package:pigeon/pigeon.dart';

@ConfigurePigeon(
  PigeonOptions(
    dartOut: 'lib/src/messages.g.dart',
    javaOptions: JavaOptions(package: 'io.flutter.plugins.urllauncher'),
    javaOut:
        'android/src/main/java/io/flutter/plugins/urllauncher/Messages.java',
    copyrightHeader: 'pigeons/copyright.txt',
  ),
)

@HostApi()
abstract class Messages {
  TestModel getTestModel(TestModel2 model);

  void testVoid();

  Response getResponse();
}

/// Response class
class Response {
  Response({required this.model});

  final TestModel2 model;
}
```

WIP

Run the generator to produce a flattened file (same path, with a `.g.dart` suffix):

```sh
# From the repo root
pigeon_gen_cli gen -i example/my_plugin/my_plugin_android/pigeons/messages_api.dart

# Or with an absolute path
pigeon_gen_cli gen -i /Users/you/path/to/example/my_plugin/my_plugin_android/pigeons/messages_api.dart
```

This generates `messages_api.g.dart` which contains your APIs plus all referenced types, inline, and only imports `package:pigeon/pigeon.dart`. A shortened preview:

```dart
// messages_api.g.dart (excerpt)
import 'package:pigeon/pigeon.dart';

// Flattened external types
enum TestEnum { value1, value2, value3 }

class TestModel3 {
  final String data;
  final TestEnum enumValue;
  const TestModel3({required this.data, required this.enumValue});
}

enum TestEnum1 { value1, value2, value3 }

class TestModel {
  final String data;
  final TestModel3 model;
  final TestEnum1 enumValue;
  const TestModel({required this.data, required this.model, required this.enumValue});
}

class TestModel2 {
  final String data;
  final TestModel3 model;
  const TestModel2({required this.data, required this.model});
}

// Original API types
class Response { Response({required this.model}); final TestModel2 model; }
class Response2 { Response2({required this.model}); final TestModel2 model; }

@HostApi()
abstract class Messages {
  TestModel getTestModel(TestModel2 model);
  void testVoid();
  Response getResponse();
  Response2 getResponse2();
}
```


---

## Getting Started ðŸš€

If the CLI application is available on [pub](https://pub.dev), activate globally via:

```sh
dart pub global activate pigeon_gen_cli
```

Or locally via:

```sh
dart pub global activate --source=path <path to this package>
```

## Usage

```sh
# Sample command
$ pigeon_gen_cli sample

# Sample command option
$ pigeon_gen_cli sample --cyan

# Show CLI version
$ pigeon_gen_cli --version

# Show usage help
$ pigeon_gen_cli --help
```

## Running Tests with coverage ðŸ§ª

To run all unit tests use the following command:

```sh
$ dart pub global activate coverage 1.15.0
$ dart test --coverage=coverage
$ dart pub global run coverage:format_coverage --lcov --in=coverage --out=coverage/lcov.info
```

To view the generated coverage report you can use [lcov](https://github.com/linux-test-project/lcov)
.

```sh
# Generate Coverage Report
$ genhtml coverage/lcov.info -o coverage/

# Open Coverage Report
$ open coverage/index.html
```

---

[coverage_badge]: coverage_badge.svg
[license_badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license_link]: https://opensource.org/licenses/MIT
[very_good_analysis_badge]: https://img.shields.io/badge/style-very_good_analysis-B22C89.svg
[very_good_analysis_link]: https://pub.dev/packages/very_good_analysis
[very_good_cli_link]: https://github.com/VeryGoodOpenSource/very_good_cli